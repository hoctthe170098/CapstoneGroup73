<div class="hoc-sinh-wrapper">
  <!-- Tiêu đề -->
  <h2 class="page-title">DANH SÁCH GIÁO VIÊN</h2>
  <div class="filter-row">
    <select class="form-control dropdown-filter" [(ngModel)]="trangThai" (change)="filterByStatus()">
      <option value="">Tất cả trạng thái</option>
      <option value="Hoạt động">Hoạt động</option>
      <option value="Tạm ngừng">Không Hoạt Động</option>
    </select>



    <input type="text" class="form-control search-input" placeholder="Tìm tên/code giáo viên..."
    [(ngModel)]="searchTerm" (keyup.enter)="searchGiaoVien()" />


    <div class="btn-group-right">

      <button class="btn choose-file-btn" (click)="onChooseFileclick()">Chọn Tệp</button>


      <button class="btn export-file-btn" (click)="onExportFile()">Xuất Tệp</button>


      <button class="btn add-student-btn" (click)="openAddStudentModal()">+ Thêm Giáo Viên</button>
    </div>
  </div>

  <!-- Pop-up Thêm giáo viên -->
  <div class="modal-container" *ngIf="isModalOpen">
    <!-- Lớp overlay -->
    <div class="modal-overlay" (click)="closeModal()"></div>

    <!-- Khung trắng pop-up -->
    <div class="modal-content">
      <div class="modal-header">
        <h2>THÊM GIÁO VIÊN MỚI</h2>
        <button class="close-btn" (click)="closeModal()">✕</button>
      </div>

      <div class="modal-body">
        <form>
          <div class="form-group">
            <label>Code</label>
            <input type="text" class="form-control" placeholder="Code">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Họ và Tên</label>
              <input type="text" class="form-control" placeholder="Nhập tên" />
            </div>
            <div class="form-group">
              <label>Giới Tính</label>
              <select class="form-control">
                <option>Nam</option>
                <option>Nữ</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ngày Sinh</label>
              <div class="input-group">
                <input type="date" class="form-control" />
                <div class="input-group-append">
                  <span class="input-group-text">
                    <i class="fa fa-calendar"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" class="form-control" placeholder="Nhập email" />
            </div>
            <div class="form-group">
              <label>Số Điện Thoại</label>
              <input type="tel" class="form-control" placeholder="Nhập số điện thoại" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Trường</label>
              <input type="text" class="form-control" placeholder="Nhập trường" />
            </div>
            
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Thành phố</label>
              <select class="form-control" [(ngModel)]="newStudent.province" name="province"
                (change)="onProvinceChange($event.target.value)">
                <option value="">-- Chọn Thành phố --</option>
                <option *ngFor="let province of provinces" [value]="province.code">
                  {{ province.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label>Quận/Huyện</label>
              <select class="form-control" [(ngModel)]="newStudent.district" name="district">
                <option value="">-- Chọn Quận/Huyện --</option>
                <option *ngFor="let district of districts" [value]="district.code">
                  {{ district.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label>Địa chỉ cụ thể</label>
              <input type="text" class="form-control" placeholder="" [(ngModel)]="newStudent.diaChi" name="diaChi">
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn cancel-btn" (click)="closeModal()">Hủy</button>
            <button type="submit" class="btn save-btn">Thêm</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- POP-UP CHỈNH SỬA GIÁO VIÊN -->
  <div class="modal-container" *ngIf="isEditModalOpen">
    <div class="modal-overlay" (click)="closeEditModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>CHỈNH SỬA GIÁO VIÊN</h2>
        <button class="close-btn" (click)="closeEditModal()">✕</button>
      </div>
      <div class="modal-body">
        <form>
          <!-- Row 1: CODE (disabled) -->
          <div class="form-group">
            <label>CODE</label>
            <input type="text" class="form-control" [(ngModel)]="editStudent.code" name="edit_code" disabled>
          </div>
          <!-- Row 2: Họ và Tên, Giới Tính, Ngày Sinh -->
          <div class="form-row">
            <div class="form-group">
              <label>Họ và Tên</label>
              <input type="text" class="form-control" [(ngModel)]="editStudent.ten" name="edit_ten">
            </div>
            <div class="form-group">
              <label>Giới Tính</label>
              <select class="form-control" [(ngModel)]="editStudent.gioiTinh" name="edit_gioiTinh">
                <option>Nam</option>
                <option>Nữ</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ngày Sinh</label>
              <div class="input-group">
                <input type="date" class="form-control" [(ngModel)]="editStudent.ngaySinh" name="edit_ngaySinh">
                <div class="input-group-append">
                  <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                </div>
              </div>
            </div>
          </div>
          <!-- Row 3: Email, Số Điện Thoại -->
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" class="form-control" [(ngModel)]="editStudent.email" name="edit_email">
            </div>
            <div class="form-group">
              <label>Số Điện Thoại</label>
              <input type="tel" class="form-control" [(ngModel)]="editStudent.soDienThoai" name="edit_soDienThoai">
            </div>
          </div>
          <!-- Row 4: Trường, Cơ Sở -->
          <div class="form-row">
            <div class="form-group">
              <label>Trường</label>
              <input type="text" class="form-control" [(ngModel)]="editStudent.truongDangDay" name="edit_truongDangDay">
            </div>
            
          </div>


          <!-- Row 5: Thành phố, Quận/Huyện, Địa chỉ cụ thể -->
          <div class="form-row">
            <div class="form-group">
              <label>TP / Tỉnh</label>
              <select class="form-control" [(ngModel)]="editStudent.province" name="edit_province"
                (change)="onProvinceChangeForEdit($event.target.value)">
                <option value="">-- Chọn Thành phố --</option>
                <option *ngFor="let province of provinces" [value]="province.code">
                  {{ province.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label>Quận/Huyện</label>
              <select class="form-control" [(ngModel)]="editStudent.district" name="edit_district">
                <option value="">-- Chọn Quận/Huyện --</option>
                <option *ngFor="let d of editDistricts" [value]="d.code">
                  {{ d.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label>Địa chỉ cụ thể</label>
              <input type="text" class="form-control" placeholder="VD: Phạm Ngọc Thạch, số 245"
                [(ngModel)]="editStudent.diaChi" name="edit_diaChi">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn cancel-btn" (click)="closeEditModal()">Hủy</button>
        <button type="button" class="btn save-btn" (click)="submitEditStudent()">ÁP DỤNG</button>
      </div>
    </div>
  </div>


  <div class="table-responsive">
    <table class="table student-table">
      <thead>
        <tr>
          <th>Code</th>
          <th>Tên</th>
          <th>Giới Tính</th>
          <th>Ngày Sinh</th>
          <th>Email</th>
          <th>Số điện thoại</th>
          <th>Trạng thái</th>
          <th class="dropdown-col"></th>
          <th class="edit-col">Sửa</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="students.length === 0">
          <td colspan="12" style="text-align: center; color: red;">Không có giáo viên nào</td>
        </tr>
  
        <ng-container *ngFor="let gv of students; let i = index">
          <!-- Hàng tóm tắt -->
          <tr>
            <td>{{ gv.code }}</td>
            <td>{{ gv.ten }}</td>
            <td>{{ gv.gioiTinh }}</td>
            <td>{{ gv.ngaySinh | date:'dd-MM-yyyy' }}</td>
            <td>{{ gv.email }}</td>
            <td>{{ gv.soDienThoai }}</td>
            
            <td>
              <span [ngClass]="{ 'active-status': gv.isActive, 'inactive-status': !gv.isActive }">
                {{ gv.isActive ? 'Hoạt Động' : 'Không Hoạt Động' }}
              </span>
            </td>
            <!-- Nút dropdown -->
            <td class="dropdown-col">
              <button class="btn dropdown-btn" (click)="toggleDetails(i)">
                <i *ngIf="!gv.showDetails" class="fas fa-caret-down"></i>
                <i *ngIf="gv.showDetails" class="fas fa-caret-up"></i>
              </button>
            </td>
            <!-- Nút sửa (bên phải) -->
            <td class="edit-col">
              <button class="btn edit-btn" (click)="onEditStudentClick(i)">
                <i class="fas fa-pencil-alt"></i>
              </button>
            </td>
          </tr>
  
          <!-- Hàng chi tiết (hiển thị ngay dưới item đó) -->
          <tr *ngIf="gv.showDetails">
            <td colspan="12" class="detail-cell">
              <!-- Bố cục chia làm 4 hàng -->
              <div class="container-fluid">
                <!-- Row 1: Code, Họ và Tên, Giới Tính, Ngày Sinh -->
                <div class="row">
                  <div class="col-md-3 detail-item">
                    <label>Code</label>
                    <div class="detail-box">{{ gv.code }}</div>
                  </div>
                  <div class="col-md-3 detail-item">
                    <label>Họ và Tên</label>
                    <div class="detail-box">{{ gv.ten }}</div>
                  </div>
                  <div class="col-md-3 detail-item">
                    <label>Giới Tính</label>
                    <div class="detail-box">{{ gv.gioiTinh }}</div>
                  </div>
                  <div class="col-md-3 detail-item">
                    <label>Ngày Sinh</label>
                    <div class="detail-box">{{ gv.ngaySinh | date:'dd-MM-yyyy' }}</div>
                  </div>
                </div>
  
                <!-- Row 2: Số Điện Thoại, Email, Địa Chỉ -->
                <div class="row mt-3">
                  <div class="col-md-4 detail-item">
                    <label>Số Điện Thoại</label>
                    <div class="detail-box">{{ gv.soDienThoai }}</div>
                  </div>
                  <div class="col-md-4 detail-item">
                    <label>Email</label>
                    <div class="detail-box">{{ gv.email }}</div>
                  </div>
                  <div class="col-md-4 detail-item">
                    <label>Địa Chỉ</label>
                    <div class="detail-box">{{ gv.diaChi }}</div>
                  </div>
                </div>
  
                <!-- Row 3: Trường Đang Dạy, Cơ Sở -->
                <div class="row mt-3">
                  <div class="col-md-4 detail-item">
                    <label>Trường Đang Dạy</label>
                    <div class="detail-box">{{ gv.truongDangDay }}</div>
                  </div>
                  <div class="col-md-4 detail-item">
                    <label>Cơ Sở</label>
                    <div class="detail-box">{{ gv.tenCoSo }}</div>
                  </div>
                </div>
  
                <!-- Row 4: Danh Sách Lớp Đang Dạy -->
                <div class="row mt-3">
                  <div class="col-12 detail-item">
                    <label>Danh Sách Lớp Đang Dạy</label>
                    <div class="detail-box">
                      {{ gv.lopHocs.length ? gv.lopHocs.join(', ') : 'Không có lớp nào' }}
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Phân trang -->
  <div class="pagination-container">
    <ul class="pagination">
      <li class="page-item" [class.active]="currentPage === 1">
        <a class="page-link" (click)="goToPage(1)">1</a>
      </li>
      <li class="page-item" [class.active]="currentPage === 2">
        <a class="page-link" (click)="goToPage(2)">2</a>
      </li>
    </ul>
  </div>